<html>
<head>
  <title>WiFi Keyboard</title>
  <script language="JavaScript">
    // format: /seq,code,press/5012,32,1/
    data = "";
    seq = 12345;
    function send(code, mode) {
      data = mode + code + "," + data;

//      var el = document.getElementById("keys");
//      el.appendChild(document.createTextNode(mode + code + " "));

      if (1) {
      seq = seq + 1;
      if (data.length > 200) data = data.substring(0, 200);
      xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
	if (xhr.readyState != 4) return;
        stat = document.getElementById("status");
        if (xhr.status != 200) {
          stat.innerHTML = "Connection problem";
          stat["color"] = "red";
          comment.innerHTML = "No connection between the phone and computer.";
        } else {
          if (xhr.responseText != "ok") {
            stat.innerHTML = "Not typing";
            stat["color"] = "red";
          comment.innerHTML = 'Enable WiFiKeyboard input on you device. <a href="http://code.google.com/p/wifikeyboard/wiki/WiFiKeyboardSettings">Visit help page.</a>';
          } else {
            stat.innerHTML = "Connected";
            stat["color"] = "green";
            comment.innerHTML = "You can type now.";
          }
        }
      }
      xhr.open('GET', "/" + seq + "," + data, true);                  
      xhr.send(null);
      }
    }

    function compat() {
      return !document.f.mode[0].checked;
    }

    function is_special(code) {
      if (code <= 40) {
        if (code >= 33) return true;
	if (code == 8 || code == 9 || code == 13 || code == 27) return true;
	if (code >= 16 && code <= 20) return true;
      } else {
        if (code == 42 || code == 45 || code == 46 || code == 93 || code == 145) return true;
	if (code >= 112 && code <= 123) return true;
      }
      return false;
    }
    function keyevent(key, mode) {
      if (compat()) {
        send(key, mode);
	return false;
      }
      if (is_special(key)) {
        send(key, mode);
	return false;
      }
      return true;
    }
    function up(e) {
      if (!e) e = window.event;
      return keyevent(e.keyCode, 'U');
    }
    function down(e) {
      if (!e) e = window.event;
      return keyevent(e.keyCode, 'D');
    }
    function press(e) {
      if (!e) e = window.event;
      if (compat()) return false;
      if (e.charCode == 0) return false;
      send(e.charCode, 'C');
      return false;
    }
    function focus_me() {
      document.getElementById("in").focus();
    }

    function loadFinished() {
      send(1024, 'D');
    }
    window.onload = loadFinished;
</script>
<link href='http://fonts.googleapis.com/css?family=Cantal' rel='stylesheet' type='text/css'>
<link href=' http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
<link href=' http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
<link rel="icon" type="image/png" href="/icon.png" />
<style type="text/css">
   h1 {
    font-family: 'Cantal', arial, serif;
    font-size: 350%;
   } 
   h2 {
    font-family: 'Yanone Kaffeesatz', arial, serif; 
    font-size: 180%;
   }
   div {
    font-family: 'Droid Sans', arial, serif;
    font-size: 150%;
    padding: 3pt;
   }

   div.footer {
    font-family: arial, serif;
    font-size: 100%;
    text-align: right;
   }
   body {
    color:#000000;
    background-color:#f1f1ed;
    margin:0px;
    overflow:auto;
   }
   table.main {
     width:800px;
     margin-top:0px;
     margin-bottom:0px;
     background-color:#ffffff;
     padding:15px;
     background-image:url('bg.gif');
     background-repeat:repeat-x;
     height: 100%;
   }
</style>
</head>
<body id="myBody"
   onkeydown="return down(event);"
   onkeyup="return up(event);"
   onkeypress="return press(event);"
   onblur="send(1024,'D');" onfocus="focus_me();"onload="focus_me(); send(1024, 'D');">
<table class="main" align="center">
<tbody>
<tr valign="top">
<td class="main">
<!-- Main Window -->
<h1>WiFi&nbsp;Keyboard</h1>
  <h2>Android input:
  <input id="in" type="text" value="Text typed here goes to android device." style="width:100%">
  </h2>

  <table border="0"><tbody><tr><td cellspacing="50" cellpadding="50">
  <form name="f">
  <h2>Keyboard mode:</h2>
  <div class="mode"><input type="radio" name="mode" value="i" checked>International keyboard</div>
  <div class="mode"><input type="radio" name="mode" value="c">Game mode (key codes only)</div>
  </form>
  </td></tr></tbody></table>

<!-- Main Window End -->
</td><td align="right">
<!-- Side bar -->
  <table border="1" cellpadding="20"><tbody><tr><td cellspacing="50" cellpadding="50">
  <h2>Status: <font color="black" id="status">Connecting...</font></h2>
  <div id="comment"></div>
  </td></tr></tbody></table>

  <br>
  <table border="0"><tbody><tr><td cellspacing="50" cellpadding="50">
  <h2>Special keys:</h2>
  <ul>
  <li>Shift = Shift</li>
  <li>Alt = Alt</li>
  <li>Arrows = DPAD Arrows</li>
  <li>Insert or F1 = DPAD Center</li>
  <li>F2 = Menu</li>
  <li>Escape = BACK</li>
  <li>F9, F10 = Volume control</li>
  </ul>
  </td></tr></tbody></table>
<!-- Side bar end -->
</td>
</tr>
<tr valign="bottom">
<td colspan="2">
  <div class="footer"><a href="http://code.google.com/p/wifikeyboard/">Source code available (license GPL v2).</a><br>Created by Ivan Volosyuk on 2010.</div>
<!-- <div id="keys">Debug: key presses:</div> -->
<td>
</tr>
</tbody>
</table>
</body>
</html>
